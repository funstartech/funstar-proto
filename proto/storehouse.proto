syntax = "proto3";
package funstar.server.storehouse;
option go_package = "github.com/funstartech/funstar-proto/go/server/storehouse";

import "product.proto";
import "wxpay.proto";

enum StoreProductStatus {
  STORE_STATUS_UNPICK_UP = 0; // 未提货
  STORE_STATUS_PICK_UP = 1; //已提货
}

message StoreProduct {
  uint64 store_id = 1;
  funstar.server.product.ProductBasic product = 2;
  uint32 level = 3; // CollectionProductLevel 如合并时有不同等级，取最高
  uint32 count = 4;
  int64 ts = 5;
}

message GetUserStoresReq {
  bytes cookie = 1;
}

message GetUserStoresRsp {
  repeated StoreProduct stores = 1;
  bytes cookie = 2;
  bool is_end = 3;
}

enum PickUpOrderStatus {
  PICKUP_ORDER_STATUS_WAIT_PAY = 0; // 待支付
  PICKUP_ORDER_STATUS_ORDER_PLACED = 1; // 待发货
  PICKUP_ORDER_STATUS_DELIVERY = 2; // 已发货
  PICKUP_ORDER_STATUS_DELIVERED = 3; // 已送达
}

message PickUpOrderInfo {
  uint64 id = 1;
  int64 create_time = 2;
  uint32 status = 3; // 订单状态 PickUpOrderStatus
  int32 total_price = 4; // (单位：分)
  string openid = 5;
  repeated StoreProduct products = 6; // 商品列表
  string address = 7; // 详细地址
  string shipping_method = 8; // 物流公司
  string shipping_number = 9 ;// 物流单号
}

message CreatePickUpOrderReq {
  repeated uint64 store_ids = 1;
  uint32 address_id = 2;
}

message CreatePickUpOrderRsp {
  PickUpOrderInfo order_info = 1;
  funstar.wxpay.WxPayment payment = 2;
  bool free_shipping = 3;
}

message GetUserPickUpOrdersReq {
  bytes cookie = 1;
}

message GetUserPickUpOrdersRsp {
  repeated PickUpOrderInfo orders = 1;
  bytes cookie = 2;
  bool is_end = 3;
}

service StorehouseSvr {
  // 拉取用户仓库
  rpc GetUserStores (GetUserStoresReq) returns (GetUserStoresRsp);
  // 创建提货单
  rpc CreatePickUpOrder (CreatePickUpOrderReq) returns (CreatePickUpOrderRsp);
  // 查询用户提货单
  rpc GetUserPickUpOrders (GetUserPickUpOrdersReq) returns (GetUserPickUpOrdersRsp);
}
